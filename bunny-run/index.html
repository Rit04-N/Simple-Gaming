<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bunny Run</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üê∞</text></svg>">

    <style>
        :root {
            --bg-dark: #1a050a;
            --bg-card: #2b0a16;
            --primary-pink: #ff4d6d;
            --text-main: #fff0f3;
        }

        body { 
            margin: 0; 
            background-color: var(--bg-dark); 
            color: var(--text-main); 
            font-family: 'Segoe UI', sans-serif; 
            text-align: center; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            user-select: none; 
            -webkit-tap-highlight-color: transparent;
        }

        h1 { margin-bottom: 10px; color: var(--primary-pink); text-shadow: 0 0 10px rgba(255, 77, 109, 0.5); }

        .game-container {
            width: 90%; 
            max-width: 600px;
            padding: 15px;
            background: var(--bg-card);
            border-radius: 20px;
            border: 2px solid var(--primary-pink);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        canvas {
            background: linear-gradient(to bottom, #2b0a16, #4a192c); 
            border-radius: 10px;
            width: 100%;
            height: auto; 
            touch-action: none; 
            border-bottom: 4px solid var(--primary-pink); 
            display: block;
        }

        .game-ui { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }

        .btn {
            background: var(--primary-pink); border: none; color: white;
            padding: 12px 25px; 
            border-radius: 50px; cursor: pointer;
            font-size: 1rem; font-weight: bold; transition: 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .btn:active { transform: scale(0.95); }
        .btn-stop { background: #880e4f; }

        .game-instructions { font-size: 0.9rem; color: #ffb3c1; margin-top: 10px; margin-bottom: 20px;}
        
        /* Back button styling */
        .back-link {
            margin-top: 20px;
            color: #ffb3c1;
            text-decoration: none;
            font-size: 0.9rem;
            opacity: 0.7;
        }
        .back-link:hover { opacity: 1; text-decoration: underline; }
    </style>
</head>
<body>

    <h1>Bunny Run üê∞</h1>

    <div class="game-container">
        <canvas id="gameCanvas" width="600" height="300"></canvas>
        
        <div class="game-instructions">
            Avoid the Cacti üåµ | Collect Carrots ü•ï<br>
            <strong>Tap or Spacebar to Jump (Double Jump available!)</strong>
        </div>

        <div class="game-ui">
            <button class="btn" onclick="startGame()">‚ñ∂ Start / Restart</button>
            <button class="btn btn-stop" onclick="pauseGame()"> Pause</button>
        </div>
        
        <h3 id="scoreDisplay">Carrots: 0</h3>
    </div>

    <a href="../index.html" class="back-link">‚Üê Back to Gaming Hub</a>

    <script>
        // --- 1. SOUND ENGINE (Synthesizer) ---
        // This creates sound without needing external mp3 files
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        function initAudio() {
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playSound(type) {
            if (!audioCtx) initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'jump') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            } 
            else if (type === 'collect') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
            else if (type === 'gameover') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(300, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.5);
                gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            }
        }

        // --- 2. GAME LOGIC ---
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        
        let gameRunning = false, isPaused = false, score = 0, animationId;
        const GROUND_Y = 220; 
        
        let player = { 
            x: 50, y: GROUND_Y, width: 40, height: 40, 
            dy: 0, jumpPower: -10, doubleJumpPower: -12, gravity: 0.6, 
            grounded: true, jumpCount: 0 
        };
        
        let obstacles = [];
        let carrots = []; // Changed from hearts to carrots
        let frame = 0;

        function updateGame() {
            if (!gameRunning || isPaused) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Player Physics
            player.dy += player.gravity; 
            player.y += player.dy;
            
            if (player.y > GROUND_Y) { 
                player.y = GROUND_Y; 
                player.dy = 0; 
                player.grounded = true; 
                player.jumpCount = 0; 
            }
            
            // Spawn Items (frame counter)
            if (frame % 90 === 0) {
                if (Math.random() < 0.3) {
                    obstacles.push({ x: canvas.width, y: GROUND_Y + 10, width: 20, height: 30 });
                } else {
                    // Random height for carrots
                    carrots.push({ x: canvas.width, y: [GROUND_Y + 10, 140, 60][Math.floor(Math.random()*3)], width: 30, height: 30 });
                }
            }

            // Draw Player
            ctx.font = "40px Arial"; 
            ctx.fillText("üê∞", player.x, player.y + 40);
            
            function isColliding(p, r) {
                let padding = 10; 
                return (
                    p.x + padding < r.x + r.width - padding &&
                    p.x + p.width - padding > r.x + padding &&
                    p.y + padding < r.y + r.height - padding &&
                    p.y + p.height - padding > r.y + padding
                );
            }

            // Draw & Move Obstacles (Cacti)
            ctx.font = "30px Arial";
            for (let i = obstacles.length - 1; i >= 0; i--) {
                let obs = obstacles[i];
                obs.x -= 5; // Speed
                ctx.fillText("üåµ", obs.x, obs.y + 30);
                
                if (isColliding(player, obs)) {
                    playSound('gameover');
                    gameOver();
                }
                if (obs.x + obs.width < 0) obstacles.splice(i, 1);
            }

            // Draw & Move Carrots
            for (let i = carrots.length - 1; i >= 0; i--) {
                let c = carrots[i];
                c.x -= 5; 
                ctx.fillText("ü•ï", c.x, c.y + 30);
                
                if (isColliding(player, c)) {
                    carrots.splice(i, 1); 
                    score += 1; 
                    playSound('collect');
                    document.getElementById("scoreDisplay").innerText = "Carrots: " + score;
                } 
                else if (c.x + c.width < 0) {
                    carrots.splice(i, 1); 
                }
            }

            frame++; 
            animationId = requestAnimationFrame(updateGame);
        }

        function jump() {
            if (!gameRunning) return;
            
            if (player.grounded) { 
                player.dy = player.jumpPower; 
                player.grounded = false; 
                player.jumpCount = 1; 
                playSound('jump');
            }
            else if (player.jumpCount === 1) { 
                player.dy = player.doubleJumpPower; 
                player.jumpCount = 2; 
                playSound('jump');
            }
        }

        function startGame() {
            initAudio(); // Initialize Audio on Click
            if (gameRunning && !isPaused) return;
            if (isPaused) { isPaused = false; updateGame(); return; }
            
            // Reset variables
            player.y = GROUND_Y; 
            obstacles = []; 
            carrots = []; 
            score = 0; 
            frame = 0;
            
            gameRunning = true; 
            isPaused = false; 
            document.getElementById("scoreDisplay").innerText = "Carrots: 0";
            updateGame();
        }

        function pauseGame() {
            if (!gameRunning) return; 
            isPaused = true;
            ctx.fillStyle = "rgba(43, 10, 22, 0.8)"; 
            ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "#ffb3c1"; 
            ctx.font = "bold 30px Arial"; 
            ctx.fillText("Paused ‚è∏", canvas.width/2 - 60, canvas.height/2);
        }

        function gameOver() {
            gameRunning = false; 
            cancelAnimationFrame(animationId);
            
            ctx.fillStyle = "rgba(43, 10, 22, 0.9)"; 
            ctx.fillRect(0,0,canvas.width, canvas.height);
            
            ctx.textAlign = "center";
            ctx.fillStyle = "#ff4d6d"; 
            ctx.font = "bold 30px Arial"; 
            ctx.fillText("Game Over!", canvas.width/2, canvas.height/2 - 20);
            
            ctx.fillStyle = "#fff0f3"; 
            ctx.font = "20px Arial"; 
            ctx.fillText("You collected " + score + " carrots!", canvas.width/2, canvas.height/2 + 20);
            ctx.textAlign = "start";
        }

        // Controls
        document.addEventListener("keydown", (e) => { 
            if (e.code === "Space" || e.code === "ArrowUp") { 
                e.preventDefault(); 
                jump(); 
            } 
        });
        
        canvas.addEventListener("touchstart", (e) => { 
            e.preventDefault(); 
            jump(); 
        });
    </script>
</body>
</html>
